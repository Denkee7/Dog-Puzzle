<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Doggy Puzzle</title>
<style>
  :root{
    --size:6;             /* 6√ó6 */
    --tile:90px;          /* —Ä–∞–∑–º–µ—Ä –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –∫–≤–∞–¥—Ä–∞—Ç–∞ –¥–µ—Ç–∞–ª–∏ */
    --gap:6px;            /* –∑–∞–∑–æ—Ä –º–µ–∂–¥—É —Å–ª–æ—Ç–∞–º–∏ */
    --board-bg:#f2f2f5;
    --slot-border:#d9d9df;
    --accent:#ffb74d;
    --ink:#222;
  }
  *{box-sizing:border-box}
  body{
    margin:0; min-height:100vh; display:flex; flex-direction:column; align-items:center; gap:18px;
    font-family: ui-sans-serif, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    background: radial-gradient(1200px 800px at 10% -10%, #ffffff 0%, #faf6fb 55%, #f2edf3 100%);
    padding:18px;
  }
  h2{margin:6px 0 0 0; font-weight:700; color:var(--ink)}
  .hud{display:flex; gap:8px; flex-wrap:wrap; align-items:center}
  .btn{
    border:0; background:var(--accent); color:#fff; padding:10px 14px; border-radius:10px; font-weight:700; cursor:pointer;
    transition: transform .08s ease, filter .2s ease;
  }
  .btn:hover{ filter:brightness(0.98)}
  .btn:active{ transform: scale(.98); }
  .btn.ghost{background:#ececf3; color:#333}
  .pill{background:#f1f1f6; border-radius:999px; padding:6px 10px; font-size:13px; color:#555}

  .stage{ display:grid; grid-template-columns:auto 1fr; gap:16px; width:min(1100px, 100%); }
  @media (max-width:900px){ .stage{grid-template-columns:1fr} }

  .board-wrap{display:flex; flex-direction:column; align-items:center; gap:12px}
  .board{
    position:relative; user-select:none; touch-action:none;
    background:var(--board-bg);
    border-radius:16px; padding:var(--gap);
    box-shadow: inset 0 0 0 2px rgba(0,0,0,.04), 0 20px 40px rgba(0,0,0,.06);
  }
  .grid{
    display:grid;
    grid-template-columns: repeat(var(--size), var(--tile));
    grid-template-rows:    repeat(var(--size), var(--tile));
    gap: var(--gap);
  }

  /* —Å–ª–æ—Ç—ã (—Ä–∞–º–∫–∏) */
  .slot{
    width:var(--tile); height:var(--tile); border-radius:14px;
    position:relative; overflow:hidden;
    background: radial-gradient(120% 120% at 10% 10%, #ffffff 0%, #f8f8fb 55%, #f0eef4 100%);
    outline: 2px dashed var(--slot-border); outline-offset:-12px;
    box-shadow:
      inset 0 6px 18px rgba(255,255,255,.85),
      inset 0 -10px 18px rgba(0,0,0,.06),
      0 2px 6px rgba(0,0,0,.05);
  }
  .slot.correct{
    outline-color:#9ad27b;
    background: radial-gradient(120% 120% at 10% 10%, #fbfffb 0%, #f2fff0 55%, #e9f7e5 100%);
    box-shadow:
      inset 0 6px 18px rgba(255,255,255,.9),
      inset 0 -10px 18px rgba(74,170,50,.12),
      0 2px 6px rgba(74,170,50,.12);
  }
  .slot.highlight{ box-shadow: inset 0 0 0 5px rgba(255,183,77,.35), 0 2px 8px rgba(0,0,0,.06); }

  .tray{
    min-height:calc(var(--tile) + 16px);
    background:#ffffff; border-radius:12px; padding:10px; display:flex; flex-wrap:wrap; gap:8px;
    box-shadow: inset 0 0 0 1px rgba(0,0,0,.05);
  }

  .piece{
    position:absolute; cursor:grab; overflow:visible;
    transition:
      box-shadow .15s ease,
      transform .18s cubic-bezier(.2,.8,.2,1),
      left .18s cubic-bezier(.2,.8,.2,1),
      top  .18s cubic-bezier(.2,.8,.2,1);
    filter: drop-shadow(0 10px 18px rgba(0,0,0,.14));
  }
  .piece.in-tray{ position:relative; }
  .piece:active{ cursor:grabbing; transform: scale(1.03); }
  .piece svg{ width:100%; height:100%; display:block; overflow:visible }

  .preview{ display:none; opacity:0; transition:.4s ease; }
  .preview.show{ display:block; opacity:1; }
  .preview img{
    width: calc(var(--tile)*var(--size));
    border-radius:14px; border:2px solid #ddd; box-shadow:0 10px 28px rgba(0,0,0,.14);
  }

  .toast{ position:fixed; left:50%; bottom:22px; transform:translateX(-50%) translateY(12px);
    background:#111; color:#fff; padding:10px 14px; border-radius:12px; opacity:0; pointer-events:none;
    transition:.25s ease; font-size:14px;
  }
  .toast.show{ opacity:1; transform:translateX(-50%) translateY(0) }
</style>
</head>
<body>
  <h2>üêæ Doggy puzzle</h2>
  <div class="hud">
    <span class="pill">Detaƒºas: <b id="done">0</b>/36</span>
    <button id="shuffle" class="btn">Sajaukt</button>
    <button id="togglePreview" class="btn ghost">ParƒÅdƒ´t piemƒìru üì∏</button>
  </div>

  <div class="stage">
    <div class="board-wrap">
      <div id="board" class="board">
        <div id="grid" class="grid"></div>
      </div>
      <div id="tray" class="tray"></div>
    </div>
    <div class="preview" id="preview">
      <img id="previewImg" alt="preview">
    </div>
  </div>

  <div id="toast" class="toast">Gatavs!</div>

<script>
/* ======== –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ======== */
/* –ó–ê–ú–ï–ù–ò —Å—Å—ã–ª–∫—É –Ω–∏–∂–µ –Ω–∞ —Å–≤–æ—é —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é (–ø—É–±–ª–∏—á–Ω—ã–π URL) */
const IMG_URL = 'IMG_1002.jpeg';

const SIZE = 6;                 // 6√ó6 = 36 —ç–ª–µ–º–µ–Ω—Ç–æ–≤
const TILE = 90;                // px (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∫–≤–∞–¥—Ä–∞—Ç —Å–ª–æ—Ç–∞)
const GAP  = 6;                 // px
const PAD  = Math.round(TILE*0.24); // –≤–Ω–µ—à–Ω–∏–π –æ—Ç—Å—Ç—É–ø –¥–ª—è ¬´—É—à–µ–∫¬ª

/* ======== DOM ======== */
const board  = document.getElementById('board');
const grid   = document.getElementById('grid');
const tray   = document.getElementById('tray');
const movesEl= document.getElementById('moves');
const doneEl = document.getElementById('done');
const shuffleBtn = document.getElementById('shuffle');
const togglePreviewBtn = document.getElementById('togglePreview');
const previewBox = document.getElementById('preview');
const previewImg = document.getElementById('previewImg');
const toastEl = document.getElementById('toast');

/* ======== –°–æ—Å—Ç–æ—è–Ω–∏–µ ======== */
let slots = [];  // {el, row, col, x, y, index}
let pieces = []; // {el, row, col, homeIndex, placed:false, slotIndex:null, x, y}
let dragging = null;
let moves = 0, done = 0;

/* CSS vars */
document.documentElement.style.setProperty('--size', SIZE);
document.documentElement.style.setProperty('--tile', TILE+'px');
document.documentElement.style.setProperty('--gap',  GAP+'px');

/* –†–∞–∑–º–µ—Ä –¥–æ—Å–∫–∏ (–∫–≤–∞–¥—Ä–∞—Ç) */
const boardWidth  = SIZE*TILE + (SIZE-1)*GAP + 2*GAP;
const boardHeight = SIZE*TILE + (SIZE-1)*GAP + 2*GAP;
board.style.width  = boardWidth + 'px';
board.style.height = boardHeight + 'px';

/* –ü—Ä–µ–≤—å—é */
previewImg.src = IMG_URL;

/* ===== –ú–∞—Ç—Ä–∏—Ü—ã —Å–æ–µ–¥–∏–Ω–∏—Ç–µ–ª–µ–π (—É—à–∫–∏/–≤—ã—Ä–µ–∑—ã) ===== */
const connectorsTop    = Array.from({length: SIZE}, ()=>Array(SIZE).fill(0));
const connectorsLeft   = Array.from({length: SIZE}, ()=>Array(SIZE).fill(0));

for(let r=0;r<SIZE;r++){
  for(let c=0;c<SIZE;c++){
    if(r===0) connectorsTop[r][c]=0; else connectorsTop[r][c] = Math.random()<0.5?1:-1;
    if(c===0) connectorsLeft[r][c]=0; else connectorsLeft[r][c]= Math.random()<0.5?1:-1;
  }
}

/* ===== –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å–µ—Ç–∫–∏ —Å–ª–æ—Ç–æ–≤ ===== */
function buildGrid(){
  grid.innerHTML = '';
  slots = [];
  for(let r=0;r<SIZE;r++){
    for(let c=0;c<SIZE;c++){
      const slot = document.createElement('div');
      slot.className = 'slot';
      grid.appendChild(slot);
      slots.push({ el: slot, row:r, col:c, x:0, y:0, index:r*SIZE+c });
    }
  }
  // –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Å–ª–æ—Ç–æ–≤
  const bcr = board.getBoundingClientRect();
  slots.forEach(s=>{
    const r = s.el.getBoundingClientRect();
    s.x = r.left - bcr.left + board.scrollLeft + GAP;
    s.y = r.top  - bcr.top  + board.scrollTop  + GAP;
  });
}

/* ===== –ö—Ä–∏–≤—ã–µ —Å—Ç–æ—Ä–æ–Ω (—É—à–∫–∏) ===== */
function sideCurve(side, sign, s){
  if(sign===0){
    if(side==='top')    return `L ${s} 0`;
    if(side==='right')  return `L ${s} ${s}`;
    if(side==='bottom') return `L 0 ${s}`;
    if(side==='left')   return `L 0 0`;
  }
  const mid = s/2;
  const tab = s*0.22;
  const neck= s*0.10;
  const k = 0.5522847498;
  const t = tab*sign;

  if(side==='top'){
    return [
      `L ${mid - neck} 0`,
      `C ${mid - neck} 0, ${mid - neck} ${-t*k}, ${mid} ${-t}`,
      `C ${mid + neck} ${-t*k}, ${mid + neck} 0, ${mid + neck} 0`,
      `L ${s} 0`
    ].join(' ');
  }
  if(side==='right'){
    return [
      `L ${s} ${mid - neck}`,
      `C ${s} ${mid - neck}, ${s + t*k} ${mid - neck}, ${s + t} ${mid}`,
      `C ${s + t*k} ${mid + neck}, ${s} ${mid + neck}, ${s} ${mid + neck}`,
      `L ${s} ${s}`
    ].join(' ');
  }
  if(side==='bottom'){
    return [
      `L ${mid + neck} ${s}`,
      `C ${mid + neck} ${s}, ${mid + neck} ${s + t*k}, ${mid} ${s + t}`,
      `C ${mid - neck} ${s + t*k}, ${mid - neck} ${s}, ${mid - neck} ${s}`,
      `L 0 ${s}`
    ].join(' ');
  }
  if(side==='left'){
    return [
      `L 0 ${mid + neck}`,
      `C 0 ${mid + neck}, ${-t*k} ${mid + neck}, ${-t} ${mid}`,
      `C ${-t*k} ${mid - neck}, 0 ${mid - neck}, 0 ${mid - neck}`,
      `L 0 0`
    ].join(' ');
  }
  return '';
}
function piecePath(r,c,s){
  const topSign    = (r===0)?0:connectorsTop[r][c];
  const leftSign   = (c===0)?0:connectorsLeft[r][c];
  const rightSign  = (c===SIZE-1)?0: -connectorsLeft[r][c+1];
  const bottomSign = (r===SIZE-1)?0: -connectorsTop[r+1][c];

  const top    = sideCurve('top',    topSign, s);
  const right  = sideCurve('right',  rightSign, s);
  const bottom = sideCurve('bottom', bottomSign, s);
  const left   = sideCurve('left',   leftSign, s);

  return ['M 0 0', top, right, bottom, left, 'Z'].join(' ');
}

/* ===== SVG-–¥–µ—Ç–∞–ª—å (—Å PAD, —á—Ç–æ–±—ã —É—à–∏ –Ω–µ –æ–±—Ä–µ–∑–∞–ª–∏—Å—å) ===== */
function createPieceSVG(imgURL, r, c){
  const s = TILE;
  const fullW = TILE*SIZE, fullH = TILE*SIZE;
  const pathD = piecePath(r,c,s);

  const svgNS = 'http://www.w3.org/2000/svg';
  const svg = document.createElementNS(svgNS, 'svg');
  svg.setAttribute('viewBox', `${-PAD} ${-PAD} ${s+2*PAD} ${s+2*PAD}`);
  svg.style.overflow = 'visible';
  svg.setAttribute('width', s + 2*PAD);
  svg.setAttribute('height', s + 2*PAD);

  const defs = document.createElementNS(svgNS, 'defs');
  const clip = document.createElementNS(svgNS, 'clipPath');
  const clipId = `cp-${r}-${c}-${Math.random().toString(36).slice(2)}`;
  clip.setAttribute('id', clipId);
  const path = document.createElementNS(svgNS, 'path');
  path.setAttribute('d', pathD);
  clip.appendChild(path);
  defs.appendChild(clip);
  svg.appendChild(defs);

  const img = document.createElementNS(svgNS, 'image');
  img.setAttributeNS('http://www.w3.org/1999/xlink','href', imgURL);
  /* –≤–∞–∂–Ω–æ–µ! –ö–∞–¥—Ä–∏—Ä—É–µ–º –ø–æ–¥ –∫–≤–∞–¥—Ä–∞—Ç –±–µ–∑ –∏—Å–∫–∞–∂–µ–Ω–∏—è */
  img.setAttribute('preserveAspectRatio','xMidYMid slice');
  img.setAttribute('x', -c*TILE - PAD);
  img.setAttribute('y', -r*TILE - PAD);
  img.setAttribute('width', fullW + 2*PAD);
  img.setAttribute('height', fullH + 2*PAD);
  img.setAttribute('clip-path', `url(#${clipId})`);
  svg.appendChild(img);

  const stroke = document.createElementNS(svgNS,'path');
  stroke.setAttribute('d', pathD);
  stroke.setAttribute('fill','none');
  stroke.setAttribute('stroke','#ffffff');
  stroke.setAttribute('stroke-width','2');
  stroke.setAttribute('clip-path', `url(#${clipId})`);
  svg.appendChild(stroke);

  return svg;
}

/* ===== –°–æ–∑–¥–∞–Ω–∏–µ –¥–µ—Ç–∞–ª–µ–π ===== */
function buildPieces(imgURL){
  tray.innerHTML = '';
  pieces = [];
  const all = Array.from({length: SIZE*SIZE}, (_,i)=>i).sort(()=>Math.random()-0.5);

  all.forEach((idx)=>{
    const r = Math.floor(idx / SIZE);
    const c = idx % SIZE;

    const el = document.createElement('div');
    el.className = 'piece in-tray';
    el.style.width  = (TILE + 2*PAD) + 'px';
    el.style.height = (TILE + 2*PAD) + 'px';

    const svg = createPieceSVG(imgURL, r, c);
    el.appendChild(svg);
    tray.appendChild(el);

    const piece = { el, row:r, col:c, homeIndex: r*SIZE + c, placed:false, slotIndex:null, x:0, y:0 };
    pieces.push(piece);
    enableDrag(piece);
  });

  moves = 0; done = 0;
  movesEl.textContent = '0'; doneEl.textContent = '0';
}

/* ===== Drag & Drop ===== */
function enableDrag(piece){
  const el = piece.el;

  el.addEventListener('pointerdown', (e)=>{
    e.preventDefault();
    if(piece.placed) return;

    if(el.classList.contains('in-tray')){
      el.classList.remove('in-tray');
      board.appendChild(el);
      // —Å—Ç–∞—Ä—Ç –ø–æ —Ü–µ–Ω—Ç—Ä—É
      piece.x = (board.clientWidth - (TILE + 2*PAD))/2;
      piece.y = (board.clientHeight - (TILE + 2*PAD))/2;
      el.style.left = piece.x + 'px';
      el.style.top  = piece.y + 'px';
      el.style.position = 'absolute';
    }

    const rect = el.getBoundingClientRect();
    const bcr  = board.getBoundingClientRect();
    dragging = {
      piece,
      offX: (e.clientX - rect.left),
      offY: (e.clientY - rect.top),
      boardLeft: bcr.left,
      boardTop:  bcr.top
    };
    el.setPointerCapture?.(e.pointerId || 0);
    el.style.zIndex = Date.now();

    highlightHomeSlot(piece);
  });

  window.addEventListener('pointermove', (e)=>{
    if(!dragging || dragging.piece!==piece) return;
    const {boardLeft, boardTop, offX, offY} = dragging;

    const minX = -PAD;
    const maxX = board.clientWidth  - (TILE + PAD);
    const minY = -PAD;
    const maxY = board.clientHeight - (TILE + PAD);

    piece.x = e.clientX - boardLeft - offX;
    piece.y = e.clientY - boardTop  - offY;
    piece.x = Math.max(minX, Math.min(piece.x, maxX));
    piece.y = Math.max(minY, Math.min(piece.y, maxY));
    el.style.left = piece.x + 'px';
    el.style.top  = piece.y + 'px';
  });

  window.addEventListener('pointerup', ()=>{
    if(!dragging || dragging.piece!==piece) return;
    trySnapHome(piece);
    dragging = null;
    clearHighlights();
  });
}

/* –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –Ω—É–∂–Ω–æ–≥–æ —Å–ª–æ—Ç–∞ */
function highlightHomeSlot(piece){
  clearHighlights();
  const s = slots[piece.homeIndex];
  if(s) s.el.classList.add('highlight');
}
function clearHighlights(){ slots.forEach(s=>s.el.classList.remove('highlight')); }

/* –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ ¬´–º–∞–≥–Ω–∏—Ç–∞¬ª: –µ—Å—Ç—å –ª–∏ —É–∂–µ —Å—Ç–æ—è—â–∏–µ —Å–æ—Å–µ–¥–∏ –¥–µ—Ç–∞–ª–∏ */
function hasPlacedNeighbor(piece){
  const r = piece.row, c = piece.col;
  const idx = (rr,cc)=> rr>=0 && rr<SIZE && cc>=0 && cc<SIZE ? rr*SIZE+cc : -1;
  const neighIdx = [
    idx(r, c-1), // left
    idx(r, c+1), // right
    idx(r-1, c), // top
    idx(r+1, c)  // bottom
  ].filter(i=>i>=0);
  return neighIdx.some(i=>{
    const p = pieces.find(pp=>pp.homeIndex===i);
    return p && p.placed;
  });
}

/* –°–Ω–∞–ø: –µ—Å–ª–∏ —Ä—è–¥–æ–º —Å–æ—Å–µ–¥ —Å—Ç–æ–∏—Ç ‚Äî —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –¥–æ–ø—É—Å–∫ (—ç—Ñ—Ñ–µ–∫—Ç –º–∞–≥–Ω–∏—Ç–∞) */
function trySnapHome(piece){
  if(piece.placed) return;
  const s = slots[piece.homeIndex];
  if(!s) return;

  // —Ü–µ–Ω—Ç—Ä –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –∫–≤–∞–¥—Ä–∞—Ç–∞ –¥–µ—Ç–∞–ª–∏
  const cx = piece.x + PAD + TILE/2;
  const cy = piece.y + PAD + TILE/2;
  // —Ü–µ–Ω—Ç—Ä —Å–ª–æ—Ç–∞
  const sx = s.x + TILE/2;
  const sy = s.y + TILE/2;
  const dx = sx - cx, dy = sy - cy;
  const dist = Math.hypot(dx, dy);

  /* –º–∞–≥–Ω–∏—Ç: –µ—Å–ª–∏ —Ö–æ—Ç—å –æ–¥–∏–Ω —Å–æ—Å–µ–¥ —É–∂–µ —Å—Ç–æ–∏—Ç, —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ä–∞–¥–∏—É—Å –∑–∞—Ö–≤–∞—Ç–∞ */
  const magnet = hasPlacedNeighbor(piece);
  const tolerance = TILE * (magnet ? 0.75 : 0.45);

  if(dist <= tolerance){
    piece.x = s.x - PAD;
    piece.y = s.y - PAD;
    piece.el.style.left = piece.x + 'px';
    piece.el.style.top  = piece.y + 'px';
    piece.placed = true;
    piece.slotIndex = s.index;
    s.el.classList.add('correct');
    movesEl.textContent = String(++moves);
    doneEl.textContent  = String(++done);
    if(done === SIZE*SIZE) toast('–°–æ–±—Ä–∞–Ω–æ! ‚ú®');
  } else {
    returnToTray(piece);
    movesEl.textContent = String(++moves);
  }
}

/* –í–µ—Ä–Ω—É—Ç—å –≤ –ª–æ—Ç–æ–∫ */
function returnToTray(piece){
  piece.placed = false;
  piece.slotIndex = null;
  piece.el.classList.add('in-tray');
  piece.el.style.position = 'relative';
  piece.el.style.left = '';
  piece.el.style.top  = '';
  tray.appendChild(piece.el);
}

/* –ü–µ—Ä–µ–º–µ—à–∞—Ç—å */
function shuffleAll(){
  slots.forEach(s=>{ s.el.classList.remove('correct','highlight'); });
  pieces.forEach(p=> returnToTray(p));
  const shuffled = [...pieces].sort(()=>Math.random()-0.5);
  shuffled.forEach(p=> tray.appendChild(p.el));
  moves = 0; done = 0;
  movesEl.textContent = '0'; doneEl.textContent = '0';
  toast('–ü–µ—Ä–µ–º–µ—à–∞–ª! üß©');
}

/* –¢–æ—Å—Ç */
function toast(msg){
  toastEl.textContent = msg;
  toastEl.classList.add('show');
  setTimeout(()=>toastEl.classList.remove('show'), 1500);
}

/* –ö–Ω–æ–ø–∫–∏ */
shuffleBtn.addEventListener('click', shuffleAll);
togglePreviewBtn.addEventListener('click', ()=>{
  previewBox.classList.toggle('show');
  togglePreviewBtn.textContent = previewBox.classList.contains('show')
    ? 'Aizvƒìrt piemƒìru üôà'
    : 'ParƒÅdƒ´t piemƒìru üì∏';
});

/* –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è */
function init(){
  buildGrid();
  buildPieces(IMG_URL);
}
init();
</script>
</body>
</html>